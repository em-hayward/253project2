---
title: "Gun Violence Data"
author: "Hayley Hadges, Ethan Deutsch, Em Hayward"
date: "4/23/2020"
output: html_document
---


```{r}
library(tidyverse)
library(janitor)

```

```{r}
gvd <- read_csv("GunViolenceData.csv")
```
```{r}
levels(gvd$state)
```
```{r}
colnames(gvd)
```


```{r}
# gives the data type of each column, helpful for debugging weird errors with types. Many of the types are factors
# but many functions cant operate on factors.
map(gvd, class)
```



```{r}
#create a new date column on clean data that is of the Date datatype
datefixed <- gvd
datefixed['new_date']<-as.Date(as.character(gvd$date), format='%m/%d/%Y')
class(datefixed$new_date)
```

```{r}
# get date breaks from dates to sort by week, month
datefixed$day <- as.Date(cut(datefixed$new_date,
  breaks = "day"))
datefixed$month <- as.Date(cut(datefixed$new_date,
  breaks = "month"))
datefixed$week <- as.Date(cut(datefixed$new_date,
  breaks = "week",
  start.on.monday = TRUE)) # usually starts on sunday, 2018-01-01 was a monday. makes it easier ;)
```

```{r}
# gun violence grouped by WEEK arranged in chronological order
# note to reverse order just edit arrange(desc(week))

totalsByWeek <- datefixed %>%
  group_by(week) %>%
  summarize(total=n()) %>%
  arrange(week)
```

```{r}
totalsByDay <- datefixed %>%
  group_by(day) %>%
  summarize(total=n()) %>%
  arrange(day)
```


```{r}
library(ggplot2)
library(scales)
# graph by day..... new years was CrAzY that year..:
ggplot(data = datefixed,
  aes(day, total)) +
  stat_summary(fun.y = sum,
    geom = "bar") + # or "line"
  scale_x_date(
    labels = date_format("%m-%d"),
    breaks = "1 week") # custom x-axis labels
```

```{r}
# gun violence grouped by state order descending

gvd %>%
  group_by(state) %>%
  summarize(n=n()) %>%
  arrange(desc(n))
```

```{r}
#cleandata <- 
  datefixed%>%
  mutate(female_present = str_detect(participant_gender, "Female")) %>% 
  mutate(teen_present = str_detect(participant_age_group, "Teen 12-17")) %>% 
  mutate(child_present = str_detect(participant_age_group, "Child 0-11")) %>% 
  mutate_if(is.character, replace_na, replace = "missing") %>%
  mutate_if(is.logical, replace_na, replace ="missing") %>% 
  select(-c(incident_id, incident_url_fields_missing, address, incident_url, source_url, incident_characteristics, location_description, notes, participant_name, participant_relationship, sources))
```

```{r}

```



```{r}
colnames(cleandata)
```




```{r}
library(tidyverse)
#cleandata$participant_gender <- str_replace(cleandata$participant_gender, "||", ",")
#cleandata$participant_gender <- str_replace(cleandata$participant_gender, "::", "")
#cleandata$participant_gender <- str_replace(cleandata$participant_gender, "[0123]", "")

```

```{r}
cleandata %>%
  group_by(city_or_county) %>%
  summarize(n=n()) %>%
  arrange(desc(n))
```

```{r}
cleandata %>%
  ggplot(aes(x=date, y=n_killed)) +
  geom_point()
```

```{r}
cleandata %>%
  ggplot(aes(x=date, y=n_injured)) +
  geom_point()
```

```{r}
cleandata %>%
  ggplot(aes(x = congressional_district, y = n_killed)) +
  geom_point()
```

```{r}
cleandata %>%
  ggplot(aes(x = (latitude/longitude), y = n_killed)) +
  geom_point()
```

